<script>
ThreeJSObjectBehaviour = {
      properties:{
          x: {
              type: Number,
              value: 0,
          },
          y: {
              type: Number,
              value: 0,
          },
          z: {
              type: Number,
              value: 0,
          },
          rx: {
              type: Number,
              value: 0
          },
          ry: {
              type: Number,
              value: 0
          },
          rz: {
              type: Number,
              value: 0
          },
          castShadow: {
              type: Boolean,
              value: false
          },
          receiveShadow: {
              type: Boolean,
              value: false
          },
          tracking: {
              type: Boolean,
              value: false
          }
      },
      observers : [
          'updatePosition(x,y,z)'
      ],
      setPosition: function(x, y, z) {
        this.x = x;
        this.y = y;
        this.z = z;
      },
      objectChanged: function() {
        this.updatePosition();
      },
      updatePosition: function(x,y,z) {
        if (this.object) {
          this.object.position.set(Number(this.x), Number(this.y), Number(this.z));
          this.object.rotation.set(this.rx * Math.PI/180, this.ry * Math.PI/180, this.rz * Math.PI/180);
          this.object.castShadow = this.castShadow;
          this.object.receiveShadow = this.receiveShadow;
        }
      },
      /*get position() {
        return {x: this.x, y: this.y, z: this.z};
      },*/
      addToParent3: function() {
        if (this.parentNode.add3 && !this.objectParent) {
          this.objectParent = this.parentNode;
          this.parentNode.add3(this);
          console.log('[%s]: added to threejs-object parent', this.localName + (this.id ? '#' + this.id : ''));
        }
      },
      removeFromParent3: function() {
        if (this.objectParent) {
          this.objectParent.remove3(this);
          this.objectParent = null;
          console.log('[%s]: REMOVED from threejs-object parent', this.localName + (this.id ? '#' + this.id : ''));
        }
      },
      attached: function() {
        /*
        var l = '';
        var p = this.parentNode;
        while (p) {
          l += ':' + p.localName;
          p = p.parentNode || p.host;
        }
        console.log('[%s]: attached: parent chain: [%s]', this.localName + (this.id ? '#' + this.id : ''), l);
        */
        this.async(function() {
          console.log('[%s]: lightDomReady [%d]', this.localName, this.x);
          this.updatePosition(this.x,this.y,this.z);
          if (this.localName != 'three-js-mesh')
          {
              this.lightDomReady();
          }
        });
      },
      lightDomReady: function() {
        this.addToParent3();
      },
      detached: function() {
        this.removeFromParent3();
      }
  };
</script>
